<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.mapper.ProjectMapper">
    
    <!-- 定义结果映射，确保字段正确映射 -->
    <resultMap id="ProjectResultMap" type="com.example.demo.model.entity.Project">
        <id property="projectId" column="project_id"/>
        <result property="projectCode" column="project_code"/>
        <result property="projectName" column="project_name"/>
        <result property="projectManager" column="project_manager"/>
        <result property="startDate" column="start_date"/>
        <result property="endDate" column="end_date"/>
        <result property="budget" column="budget"/>
        <result property="status" column="status"/>
        <result property="description" column="description"/>
        <result property="createUserId" column="create_user_id"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
    </resultMap>
    
    <!-- 自定义插入方法，确保字段映射正确 -->
    <insert id="insert" parameterType="com.example.demo.model.entity.Project" useGeneratedKeys="true" keyProperty="projectId" keyColumn="project_id">
        INSERT INTO project (
            project_code,
            project_name,
            project_manager,
            start_date,
            end_date,
            budget,
            status,
            description,
            create_user_id,
            create_time,
            update_time
        ) VALUES (
            #{projectCode},
            #{projectName},
            #{projectManager},
            #{startDate},
            #{endDate},
            #{budget},
            #{status},
            #{description},
            #{createUserId},
            #{createTime},
            #{updateTime}
        )
    </insert>
    
    <!-- 自定义分页查询方法，确保字段映射正确 -->
    <select id="selectProjectPage" resultMap="ProjectResultMap">
        SELECT 
            project_id,
            project_code,
            project_name,
            project_manager,
            start_date,
            end_date,
            budget,
            status,
            description,
            create_user_id,
            create_time,
            update_time
        FROM project
        <where>
            <if test="projectName != null and projectName != ''">
                AND project_name LIKE CONCAT('%', #{projectName}, '%')
            </if>
            <if test="projectCode != null and projectCode != ''">
                AND project_code LIKE CONCAT('%', #{projectCode}, '%')
            </if>
            <if test="status != null and status != ''">
                AND status = #{status}
            </if>
        </where>
        ORDER BY update_time DESC
    </select>
    
    <!-- 根据ID查询项目详情 -->
    <select id="selectById" resultMap="ProjectResultMap">
        SELECT 
            project_id,
            project_code,
            project_name,
            project_manager,
            start_date,
            end_date,
            budget,
            status,
            description,
            create_user_id,
            create_time,
            update_time
        FROM project 
        WHERE project_id = #{projectId}
    </select>
    
    <!-- 自定义更新方法，确保字段映射正确 -->
    <update id="updateById" parameterType="com.example.demo.model.entity.Project">
        UPDATE project
        <set>
            <if test="projectCode != null">project_code = #{projectCode},</if>
            <if test="projectName != null">project_name = #{projectName},</if>
            <if test="projectManager != null">project_manager = #{projectManager},</if>
            <if test="startDate != null">start_date = #{startDate},</if>
            <if test="endDate != null">end_date = #{endDate},</if>
            <if test="budget != null">budget = #{budget},</if>
            <if test="status != null">status = #{status},</if>
            <if test="description != null">description = #{description},</if>
            <if test="createUserId != null">create_user_id = #{createUserId},</if>
            <if test="createTime != null">create_time = #{createTime},</if>
            <if test="updateTime != null">update_time = #{updateTime},</if>
        </set>
        WHERE project_id = #{projectId}
    </update>
    
</mapper>

